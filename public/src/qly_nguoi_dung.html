<!DOCTYPE html>
<html lang="vn">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Quản lý người dùng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/thanh_menu.css">
    <link rel="stylesheet" href="../css/quan_tri.css">
    <link rel="stylesheet" href="../css/footer.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://kit.fontawesome.com/cfbf817f6f.js" crossorigin="anonymous"></script>
    <style>
        .user-container {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .user-box {
            padding: 10px;
            margin-bottom: 10px;
            width: 70%; /* Adjust the width as needed */
            position: relative;
        }

        .button-container {
            width: 30%; /* Adjust the width as needed */
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .return-books-btn {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #2ecc71;
            color: #fff;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .return-books-btn:hover {
            background-color: #27ae60;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <!--Header-->
        <div class="header">
            <img src="../img/logo.png" alt="LOGO" height="50px" width="auto">
            <div class="toggle">
                <i class="fas fa-bars"></i>
            </div>
            <script>
                $(document).ready(function(){
                    $(".toggle").click(function(){
                        $("nav").slideToggle();
                    })
                });
            </script>
            <nav>
                <ul class="main-menu">
                    <li><a href="../src/trang_chu.html">Trang chủ</a></li>
                    <li class="submenu">
                        <a href="../src/gioi_thieu_gtc.html">Giới thiệu</a>
                        <ul>
                            <li><a href="../src/gioi_thieu_gtc.html">Giới thiệu chung</a></li>
                            <li><a href="../src/gioi_thieu_ddtg.html">Địa điểm & Thời gian hoạt động</a></li>
                            <li><a href="../src/gioi_thieu_tlap.html">Tài liệu - Ấn phẩm</a></li>
                            <li><a href="../src/gioi_thieu_ttpb.html">Thông tin các phòng ban</a></li>
                            <li><a href="../src/gioi_thieu_sd.html">Sơ đồ thư viện</a></li>
                        </ul>
                    </li>
                    <li><a href="../src/muon_sach.html">Mượn sách</a></li>
                    <li class="submenu">
                        <a href="../src/lien_he.html">Liên hệ</a>
                    </li>
                    <!--Icon fontawsome-->
                    <li><a href="../src/gio_sach.html"><i class="fas fa-cart-shopping"></i></a></li>
                    <li><a href="../src/thong_bao.html"><i class="fas fa-bell"></i></a></li>
                    <li><a href="#" id="userLink"><i class="fas fa-user"></i></a></li>
                </ul>
            </nav>
        </div>
    
        <!--Body-->
        <h1>Quản lý người dùng</h1>
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
            import { getDatabase, ref, orderByChild, equalTo, query, get, startAt, endAt, onValue} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
            import {
            getAuth,
            onAuthStateChanged,
            createUserWithEmailAndPassword,
          } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyCxSUgNPvToIUGldmsUXgGQXF10aSSH2Hs",
                authDomain: "webapplication-19930.firebaseapp.com",
                databaseURL: "https://webapplication-19930-default-rtdb.firebaseio.com",
                projectId: "webapplication-19930",
                storageBucket: "webapplication-19930.appspot.com",
                messagingSenderId: "240590364295",
                appId: "1:240590364295:web:072e52f18a04f146c12222",
                measurementId: "G-BJXFDHBEBK"
            };
        
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            const userInDB = ref(database, 'users');
            const auth = getAuth(app);
        
        
            get(userInDB).then((snapshot) => {
                    if (snapshot.exists()) {
                        snapshot.forEach((userSnapshot) => {
                            const userData = userSnapshot.val();
                            const userKey = userSnapshot.key;
                            console.log(userData);
                            addUserToPage(userData, userKey);
                        });
                    } else {
                        searchResults.innerHTML = 'Không tìm thấy kết quả.';
                    }
                }).catch((error) => {
                    console.error('Lỗi khi thực hiện truy vấn:', error);
                });
        
            
                function addUserToPage(usersValue, usersKeys) {
                var userContainer = document.createElement('div');
                userContainer.className = 'user-container';

                var newBox = document.createElement('div');
                newBox.className = 'user-box';

                var userID = document.createElement('p');
                userID.innerText = 'User ID: ' + usersKeys;
                newBox.appendChild(userID);

                var username = document.createElement('p');
                username.innerText = 'Tên người dùng: ' + usersValue.username;
                newBox.appendChild(username);

                var email = document.createElement('p');
                email.innerText = 'Email người dùng: ' + usersValue.email;
                newBox.appendChild(email);

                if (usersValue.email === 'nhom17@gmail.com') {
                    var adminLabel = document.createElement('p');
                    adminLabel.innerText = 'Admin';
                    newBox.appendChild(adminLabel);
                }

                userContainer.appendChild(newBox);

                // Thêm button "Quản lý sách mượn" và xử lý sự kiện nhấn
                var returnBooksBtn = document.createElement('a');
                returnBooksBtn.className = 'return-books-btn';
                returnBooksBtn.innerText = 'Quản lý sách mượn';
                returnBooksBtn.href = '/src/sach_dang_muon.html?userID=' + usersKeys;
                
                // Thêm vào container button
                document.getElementById('userContainer').appendChild(returnBooksBtn);
                document.getElementById('userContainer').appendChild(userContainer);
            }

            //userLink
            document.getElementById("userLink").addEventListener("click", function(event){
              event.preventDefault();
              onAuthStateChanged(auth, (user)=> {
                if (user) {
                  const userEmail = user.email;
                  if(userEmail === "nhom17@gmail.com"){
                    window.location.href = '/src/quan_tri.html';
                  }else{
                  console.log("User login successfully");
                  window.location.href = "/src/nguoi_dung.html";
                  }
                } else {
                  console.log("User not login");
                  window.location.href = "/src/dang_nhap.html";
                }
              });
            });
        </script>
        <div id="userContainer">
    
        </div>
        <!--Footer-->
        <div class="footer">
            <div>Địa chỉ: Khu phố 6, Phường Linh Trung, Thành phố Thủ Đức, Thành phố Hồ Chí Minh.</div>
            <div class="social-link">
                <div>Facebook: fb.com/thuvien</div>
                <div>Email: thuvien@gmail.com</div>
                <div>Hotline: 123456789</div>
            </div>
        </div>
    </div>
</body>

</html>
